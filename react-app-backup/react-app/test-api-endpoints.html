<!DOCTYPE html>
<html>
<head>
    <title>Test Tax API Endpoints</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background: #e7f5e7; }
        .error { background: #ffe7e7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Test Tax API Endpoints</h1>
    
    <div class="test">
        <h2>1. Test Tax Calculation</h2>
        <button onclick="testTax()">Test Tax API</button>
        <div id="tax-result"></div>
    </div>
    
    <div class="test">
        <h2>2. Test Shipping Methods</h2>
        <button onclick="testShipping()">Test Shipping API</button>
        <div id="shipping-result"></div>
    </div>
    
    <div class="test">
        <h2>3. Test Budget API</h2>
        <button onclick="testBudget()">Test Budget API</button>
        <div id="budget-result"></div>
    </div>
    
    <div class="test">
        <h2>4. Test All Endpoints</h2>
        <button onclick="testAll()">Test All APIs</button>
    </div>

    <script>
        // Test both local dev and production URLs
        const API_BASE_PROD = 'https://dentwizard.lgstore.com/lg/API/v1';
        const API_BASE_LOCAL = 'http://localhost:3000/lg/API/v1'; // For local testing through proxy
        
        // Use production by default, can switch to local if needed
        const API_BASE = API_BASE_PROD;
        
        async function testTax() {
            const resultDiv = document.getElementById('tax-result');
            resultDiv.innerHTML = 'Testing...';
            
            console.log('Testing Tax API at:', `${API_BASE}/tax/calculate.php`);
            
            try {
                const response = await fetch(`${API_BASE}/tax/calculate.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        to_state: 'CA',
                        to_zip: '90210',
                        to_city: 'Beverly Hills',
                        amount: 100,
                        shipping: 10,
                        line_items: [{
                            id: '1',
                            quantity: 1,
                            unit_price: 100,
                            product_tax_code: '20010'
                        }]
                    })
                });
                
                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { error: 'Invalid JSON response', raw: text };
                }
                
                resultDiv.innerHTML = `
                    <div class="${response.ok ? 'success' : 'error'}">
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>URL:</strong> ${API_BASE}/tax/calculate.php<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        ${data.tax ? `<strong>CA Tax (7.25%):</strong> $${data.tax.toFixed(2)}` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}<br>URL: ${API_BASE}/tax/calculate.php</div>`;
            }
        }
        
        async function testShipping() {
            const resultDiv = document.getElementById('shipping-result');
            resultDiv.innerHTML = 'Testing...';
            
            console.log('Testing Shipping API at:', `${API_BASE}/shipping/methods.php`);
            
            try {
                const response = await fetch(`${API_BASE}/shipping/methods.php?client_id=1&subtotal=65`);
                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { error: 'Invalid JSON response', raw: text };
                }
                
                resultDiv.innerHTML = `
                    <div class="${response.ok ? 'success' : 'error'}">
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>URL:</strong> ${API_BASE}/shipping/methods.php<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}<br>URL: ${API_BASE}/shipping/methods.php</div>`;
            }
        }
        
        async function testBudget() {
            const resultDiv = document.getElementById('budget-result');
            resultDiv.innerHTML = 'Testing...';
            
            console.log('Testing Budget API at:', `${API_BASE}/user/budget.php`);
            
            try {
                const response = await fetch(`${API_BASE}/user/budget.php`);
                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { error: 'Invalid JSON response', raw: text };
                }
                
                resultDiv.innerHTML = `
                    <div class="${response.ok ? 'success' : 'error'}">
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>URL:</strong> ${API_BASE}/user/budget.php<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}<br>URL: ${API_BASE}/user/budget.php</div>`;
            }
        }
        
        async function testAll() {
            await testTax();
            await testShipping();
            await testBudget();
        }
        
        // Log the endpoints being tested
        console.log('=== API Endpoints to Deploy ===');
        console.log('Tax API:', `${API_BASE}/tax/calculate.php`);
        console.log('Shipping API:', `${API_BASE}/shipping/methods.php`);
        console.log('Budget API:', `${API_BASE}/user/budget.php`);
        console.log('');
        console.log('Files to upload from: C:\\Users\\jkrug\\OneDrive\\AI\\Claude\\dentwizard\\API\\v1\\');
        console.log('- tax\\calculate.php');
        console.log('- shipping\\methods.php');
        console.log('- user\\budget.php');
    </script>
</body>
</html>